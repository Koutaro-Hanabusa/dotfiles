# mise - Voltaより優先
eval "$(mise activate zsh)"

export NVM_DIR="$HOME/.nvm"
[ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"  # This loads nvm
[ -s "$NVM_DIR/bash_completion" ] && \. "$NVM_DIR/bash_completion"  # This loads nvm bash_completion
alias sail="bash vendor/bin/sail"
export PATH="/usr/local/opt/mysql@5.7/bin:$PATH"
export PATH="/usr/local/opt/mysql@8.3/bin:$PATH"

# Git公式のgit-prompt.shを使用してブランチ名を表示
source /opt/homebrew/etc/bash_completion.d/git-prompt.sh

# 変更状態を表示する設定
export GIT_PS1_SHOWDIRTYSTATE=1        # *=変更あり, +=ステージング済み
export GIT_PS1_SHOWUNTRACKEDFILES=1    # %=未追跡ファイルあり
export GIT_PS1_SHOWSTASHSTATE=1        # $=stashあり

setopt PROMPT_SUBST
PROMPT='%n@%m %F{blue}%~%f %F{208}$(__git_ps1 "(%s)")%f%# '

# コマンド補完候補を薄い文字で表示
source $(brew --prefix)/share/zsh-autosuggestions/zsh-autosuggestions.zsh

# Claude Code - 常にMCP設定を読み込む
alias claude='command claude --mcp-config ~/.claude/mcp.json'

# トンネリング設定（環境固有）
[ -f ~/.zsh_tunneling ] && source ~/.zsh_tunneling

# ls の色設定（ディレクトリを緑に）
export LSCOLORS=cxfxcxdxbxegedabagacad
alias ls="ls -G"

# nvim + Claude Code を左右分割で起動
# tmux内なら普通にnvim、外ならtmuxで分割起動
nvc() {
  local target="${1:-.}"
  # 既にtmux内にいる場合は普通にnvimを起動
  if [[ -n "$TMUX" ]]; then
    command nvim "$target"
    return
  fi
  # 既存のnvcセッションがあれば削除
  tmux kill-session -t nvc 2>/dev/null
  tmux new-session -d -s nvc -c "$(pwd)"
  tmux send-keys -t nvc "nvim $target; tmux kill-session -t nvc" Enter
  tmux split-window -h -t nvc -c "$(pwd)" -p 25
  tmux send-keys -t nvc "claude" Enter
  tmux select-pane -t nvc:0.0
  tmux attach-session -t nvc
}

# vim/code は全部nvc経由（矯正用）
alias vim='nvc'
alias code='nvc'

# 純粋なnvimが必要なとき用
alias nvim-raw='command nvim'

# Chrome - 新しいウィンドウで開く
alias chrome='open -na "Google Chrome" --args --new-window'

# タイポ修正
eval $(thefuck --alias)
