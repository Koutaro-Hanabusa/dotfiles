server:
  http_listen_port: 9080
  grpc_listen_port: 0

positions:
  filename: /tmp/positions.yaml

clients:
  - url: {{ .grafana_cloud.loki_url }}
    basic_auth:
      username: {{ .grafana_cloud.loki_user }}
      password: {{ env "GRAFANA_CLOUD_API_KEY" }}

scrape_configs:
  - job_name: claude-hooks
    static_configs:
      - targets:
          - localhost
        labels:
          job: claude-hooks
          pc_type: {{ if stat (joinPath .chezmoi.homeDir ".is_work_pc") }}work{{ else }}home{{ end }}
          __path__: /var/log/claude-hooks/claude-hooks.log
    pipeline_stages:
      - json:
          expressions:
            timestamp: timestamp
            tool_name: tool_name
            subagent_type: subagent_type
            skill: skill
            description: description
      - template:
          source: subagent_type
          template: '{{ "{{ if .Value }}{{ .Value }}{{ end }}" }}'
      - template:
          source: skill
          template: '{{ "{{ if .Value }}{{ .Value }}{{ end }}" }}'
      - labels:
          tool_name:
          subagent_type:
          skill:
      - timestamp:
          source: timestamp
          format: "2006-01-02T15:04:05Z"
